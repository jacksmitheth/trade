"""Get historical price data for charting."""
    if coin_id not in APIConfig.SUPPORTED_COINS:
        return jsonify({'error': 'Coin not supported'}), 400
    
    raw_data = data_fetcher.get_historical_data(coin_id=coin_id, days=90)
    
    if not raw_data:
        return jsonify({'error': 'Failed to fetch historical data'}), 500
    
    # Format for Chart.js
    prices = {
        'timestamps': [d['timestamp'].strftime('%Y-%m-%d') for d in raw_data],
        'prices': [d['price'] for d in raw_data],
        'volumes': [d['volume'] for d in raw_data]
    }
    
    return jsonify(prices)

# Background cache update on startup
with app.app_context():
    update_all_analysis()

if name == 'main':
    app.run(debug=True, host='0.0.0.0', port=5000)
